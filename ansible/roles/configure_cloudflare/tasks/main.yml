---
- name: Configure DNS records in Cloudflare
  community.general.cloudflare_dns:
    zone: "{{ lookup('ansible.builtin.env', 'DOMAIN') }}"
    type: "{{ item.type }}"
    name: "{{ item.dns_record_name }}"
    content: "{{ item.content }}"
    ttl: "{{ ttl }}"
    proxied: true
    solo: true
    api_token: "{{ lookup('ansible.builtin.env', 'CLOUDFLARE_TOKEN') }}"
  delegate_to: localhost
  no_log: true
  loop:
    - { zone: "{{ lookup('ansible.builtin.env', 'CLOUDFLARE_ZONE') }}", dns_record_name: "@", type: "A", content: "{{ inventory_hostname }}" }
    - { zone: "{{ lookup('ansible.builtin.env', 'CLOUDFLARE_ZONE') }}", dns_record_name: "www", type: "CNAME", content: "@" }